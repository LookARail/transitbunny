<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GTFS Animation</title>  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />  
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="map"></div>

<div id="controls" >
  <div class="main-menu-title">GTFS Data Sorce:</div>
  <span id="dataSourceText" style="font-size:0.98em; color:#0078d7; margin-bottom:0px; display:block;">
    Default - Vancouver GTFS Data 2025-08-08
  </span>
  <div class="main-menu-upload">
    <button id="uploadGtfsBtn"><span style="font-size:1.2em;">üìÅ</span> Load My Own GTFS ZIP</button>
    <input type="file" id="gtfsFileInput" accept=".zip" style="display:none" />
    <div id="progressBarContainer" style="display:none;">
      <div id="progressBar"></div>
    </div>
  </div>
  
  <div class="main-menu-title">Trip Filters</div>
  <div class="main-menu-filters">
    <!-- Route Type Filter -->
    <label>
      <span class="tooltip">
        Route Type:
        <span class="tooltiptext">
          Route Type Typically has the following nomenclature:<br>1 = Subway/Metro<br>2 = Rail<br>3 = Bus<br>4 = Ferry<br>MultiSelect is available
        </span>
      </span>
      <select id="routeTypeSelect" multiple size="4" style="min-width: 120px;"></select>
    </label>
    <!-- Route Name Filter -->
    <label>
      <span class="tooltip">
        Route Name:
        <span class="tooltiptext">
          Route Name is the name of the route, such as "Red Line" or "180".<br>MultiSelect is available
        </span>
      </span>
      <select id="routeShortNameSelect" multiple size="4" style="min-width: 120px; max-width: 300px;"></select>
    </label>
    <!-- Service Pattern ID Filter -->
    <label>
      <span class="tooltip">
        Service Pattern ID:    
        <span class="tooltiptext">
          Service Pattern ID is a unique identifier for the service pattern defined in the Calendar or Calendar_date file.<br>MultiSelect is available
        </span>
      </span>
      <select id="serviceIdSelect" multiple size="4" style="min-width: 120px;"></select>
    </label>
    <button id="updateMapBtn" style="margin-top:12px;">Update Map</button>
  </div>
</div>

<!-- Animation Controls Canvas -->
<div id="animationCanvas" class="floating-canvas" style="display:none;">
  <div class="canvas-header">Animation Controls</div>
  <div class="canvas-content">
    <div class="row-controls">
      <label for="speedSelect">Speed:</label>
      <select id="speedSelect">
        <option value="1">1x</option>
        <option value="10" selected>10x</option>
        <option value="60">60x</option>
        <option value="300">300x</option>
      </select>
      <span id="timeDisplay">00:00:00</span>
    </div>
    <div class="row-buttons">
      <button id="playBtn">‚ñ∂Ô∏è Play</button>
      <button id="pauseButton"> ‚èØÔ∏è Pause</button>
      <button id="stopBtn">‚èπÔ∏è Stop</button>
    </div>
  </div>
</div>


  <!-- Graphs Canvas with Tabs -->
<div id="graphsCanvas" class="floating-canvas resizable-canvas" style="display:none;">
  <div class="canvas-header">
    <button class="tab-btn active" data-tab="tripPlotTab"># of Vehicles</button>
    <button class="tab-btn" data-tab="vehKmPlotTab">Vehicle-Kilometer</button>
    <button class="tab-btn" data-tab="tripsPerHourTab">Headway</button>
  </div>
  <div class="canvas-content">
    <div id="tripPlotTab" class="tab-content active">
      <canvas id="tripPlot"></canvas>
    </div>
    <div id="vehKmPlotTab" class="tab-content">
      <canvas id="vehKmPlot"></canvas>
    </div>
    <!-- trips per hour plot -->
    <div id="tripsPerHourTab" class="tab-content">
      <div id="tripsPerHourAnnotation" style="color: #b00; font-size: 0.85em; margin-bottom: 4px; display:none"></div>
      <canvas id="tripsPerHourPlot"></canvas>
    </div>
  </div>
  <div class="resizer"></div>
</div>

<!-- Statistics Canvas with Tabs -->
<div id="statsCanvas" class="floating-canvas" style="display:none;">
  <div class="canvas-header">
    <button class="tab-btn active" data-tab="routeStatsTab">Route Statistics</button>
    <!-- Future stats tabs go here -->
  </div>
  <div class="canvas-content">
    <div id="routeStatsTab" class="tab-content active">
      <button id="GenerateStat">Generate Statistics</button>
      <button id="DownloadStat">Download CSV</button>
      <div id="routeStatsTableWrapper">
        <div id="routeStatsTable"></div>
      </div>
    </div>
  </div>
</div>

<div id="helpCanvas" class="floating-canvas" style="display:none; max-width: 700px;">
  <div class="canvas-header">
    Help &amp; Instructions
    <button id="closeHelpBtn" style="margin-left:auto; background:none; border:none; color:#fff; font-size:1.3em; cursor:pointer;">‚úñ</button>
  </div>
  <div class="canvas-content" style="overflow-y:auto; max-height: 60vh;">
    <h3>Welcome to the GTFS Web Client!</h3>
    <ul>
      <li><b>Load GTFS Data:</b> Click <b>Load My Own GTFS ZIP</b> to load your transit data. The page is pre-loaded with the default Vancouver GTFS dataset. The file format must be a ".zip" file containing standard static GTFS files such as "routes.txt", "trips.txt", and others</li>
      <li><b>Filter Trips:</b> Use the filters to select route types, route names, and service patterns. Hover over the <b>filter labels</b> for more details. Click <b>Update Map</b> to update the map to match your selection </li>
      <li><b>Animation Controls:</b> Open the <b>Animation Controls</b> panel (‚ñ∂Ô∏è) to play, pause, or stop the animation. Adjust the speed as needed</li>
      <li><b>Graphs:</b> Open the <b>Graphs</b> panel (üìà) with these graph options. <b>Graphs update in sync with the animation progress</b>
        <ul>
          <li><b>Number of Trips:</b> Shows the number of active vehicles over time</li>
          <li><b>Vehicle-Kilometer:</b> Shows cumulative vehicle-kilometers by route</li>
        </ul>
      </li>
      <li><b>Statistics:</b> Open the <b>Statistics</b> panel (üìä) for route-level stats. You can download the table as CSV. The statistics are independent from the animation progress</li>
    </ul>
    <p style="font-size:0.95em; color:#2400f3;">
      Want more helps or features? Contact me on
      <a href="https://www.linkedin.com/in/luke-li-05445086/" target="_blank" style="color:#0078d7; text-decoration:underline;">LinkedIn</a>.
      - Luke Li
    </p>
    <img src="barcode_linkedin_lukeli.jpg" alt="Barcode" style="display:block; margin: 18px auto 0 auto; max-width:220px;">  </div>
</div>

<!-- Ribbon/Taskbar at bottom -->
<div id="ribbonPanel">
  <button class="ribbon-icon" data-canvas="animationCanvas" title="Animation Controls">‚ñ∂Ô∏è</button>
  <button class="ribbon-icon" data-canvas="graphsCanvas" title="Graphs">üìà</button>
  <button class="ribbon-icon" data-canvas="statsCanvas" title="Statistics">üìä</button>
  <button class="ribbon-icon" data-canvas="helpCanvas" title="Help">‚ùì</button>
  <button class="ribbon-icon" data-canvas="" title="Future Feature">‚≠ê</button>
</div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Your main GTFS JS -->
  <script src= "https://cdn.jsdelivr.net/npm/fflate/umd/index.js"></script>
  <script src="main.js"></script>
  <script src="analysis.js"></script>
</body>
</html>
